---
description: Pre-commit verification checklist
globs:
alwaysApply: true
---

# Pre-Commit Verification

Before committing any changes, verify:

## Build & Types
- [ ] `rpgjs build` passes without errors
- [ ] `npx tsc --noEmit` passes (or only pre-existing errors)

## Agent System Safety
- [ ] All agent system errors are caught with try/catch
- [ ] No unhandled promise rejections in agent code
- [ ] LLM API errors result in graceful fallback, not crashes
- [ ] Skill execution failures return error messages to the LLM
- [ ] No global mutable state introduced

## Code Quality
- [ ] Changes stay within your agent's owned files (see AGENTS.md)
- [ ] No hardcoded API keys or secrets
- [ ] No hardcoded agent personalities (use YAML configs)
- [ ] Console logs use agent-prefixed format
- [ ] New dependencies documented in commit message

## Performance
- [ ] No agent logic in `onStep` (60 FPS) or `onChanges`
- [ ] Perception snapshots under 300 tokens
- [ ] NPCs use `EventMode.Shared`, not `Scenario`

## Runtime Files (Chat Logs, Metrics, Sessions)
- [ ] Runtime files are tracked in git (not in `.gitignore`)
- [ ] Commit runtime files when task is completed
- [ ] Commit runtime files periodically when they stabilize (after tests/reviews pass)
- [ ] Commit messages include context: `Update runtime files: [reason]`
- [ ] Chat logs (`.ai/chats/*.md`) committed at task boundaries
- [ ] Metrics (`.ai/metrics/*.json`) committed when meaningful data accumulates
- [ ] Session data committed when sessions complete or are archived

## Documentation
- [ ] If this change affects quickstart, commands, env vars, deployment, or repo structure: README.md updated (or ticketed for sprint-end update)

**Note**: See `.ai/issues/active-issues.md` Issue #6 for full runtime file tracking policy.
